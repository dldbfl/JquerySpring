<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	<mapper namespace="Member-Mapper"> <!--같은이름이 있을때 패키지 위치까지 적어준다.  -->
		
		<select id="selectMemberById" parameterType="str" resultType="member">
			select
			*
			from member
			where id = #{id}		
		</select>
		
		<select id="selectBoardByBno" parameterType="int" resultType="board">
			select 
			*
			from board
			where bno = #{bno}		
		</select>
				
		<sql id = "search">
			<if test ="searchType =='i'.toString()">
				and id like '%'||#{keyword}||'%'
			</if>
			<if test ="searchType =='p'.toString()">
				and phone like '%'||#{keyword}||'%'
			</if>
			<if test ="searchType =='e'.toString()">
				and email like '%'||#{keyword}||'%'
			</if>
			
			
			<if test ="searchType =='tcw'.toString()">
				and title like '%'||#{keyword}||'%'
				or content like '%'||#{keyword}||'%'
				or writer like '%'||#{keyword}||'%'
			</if>
			<if test ="searchType =='t'.toString()">
				and title like '%'||#{keyword}||'%'
			</if>
			<if test ="searchType =='w'.toString()">
				and writer like '%'||#{keyword}||'%'
			</if>
			<if test ="searchType =='c'.toString()">
				and content like '%'||#{keyword}||'%'
			</if>
			<if test ="searchType =='tc'.toString()">
				and title like '%'||#{keyword}||'%'
				or content like '%'||#{keyword}||'%'
			</if>
			<if test ="searchType =='cw'.toString()">
				and content like '%'||#{keyword}||'%'
				or writer like '%'||#{keyword}||'%'
			</if>
			
		</sql>
		
		
		<select id="selectSearchMemberList" resultType="member">
			select *
			from member
			where id is not null
			<include refid="search" />
			order by regDate desc
		</select>
		
		<select id="selectBoardCriteria" resultType="board">
			select *
			from board
			where writer is not null
			<include refid="search" />
			order by regDate desc
		</select>
			
		
		<select id="selectSearchMemberListCount" resultType="int">
			select 
			count(*)
			from member
			where id is not null
			<include refid="search"/>
			order by regDate desc			
		</select>
		
		<select id="selectBoardCriteriaTotalCount" resultType="int">
			select 
			count(*)
			from board
			where id is not null
			<include refid="search"/>
			order by regDate desc			
		</select>
						
		<select id="selectMemberListCount" resultType="int">
			select count(*)
			from member
		</select>
		
		<select id="selectBoardListCount" resultType="int">
			select count(*)
			from board
		</select>
		
		<update id="insertMember" parameterType="member">
			insert into
			member(id, pwd, email, phone, picture, name)
			values(#{id},#{pwd},#{email},#{phone},#{picture},#{name})
		</update>	
		
		<update id="insertBoard" parameterType="board">
			insert into
			board(bno, title, writer, content, viewcnt, regDate)
			values(#{bno},#{title},#{writer},#{content},sysdate)
		</update>	
		
		<update id="updateMember" parameterType="member">
				update member 
				set 
				pwd=#{pwd},email=#{email},phone=#{phone},name=#{name},
				picture=#{picture}
			
			<if test="authority != null">
				,authority=#{authority}
			</if>
			
			where id=#{id}
		</update>
		
		<update id="updateBoard" parameterType="board">
				update board 
				set 
				title=#{title},content=#{content},viewcnt=viewcnt.nextval,updatedate=sysdate,
				where bno=#{bno}
		</update>
		
		<update id="deleteMember" parameterType="str">
			delete 
			from Member
			where id = #{id}
		</update>
		
		<update id="deleteBoard" parameterType="str">
			delete 
			from Board
			where bno = #{bno}
		</update>
		
		<update id="disabledMember">
			update member
			set enabled=0
			where id = #{id}
		</update>
		
		<update id="enabledMember">
			update member
			set enabled=1
			where id = #{id}
		</update>
		
		
		

</mapper>